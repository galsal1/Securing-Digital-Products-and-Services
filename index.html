<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>×—×–×¨×” ×œ××‘×—×Ÿ ×‘××‘×˜×—×ª ××•×¦×¨×™×</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Assistant:wght@400;600;700&display=swap" rel="stylesheet" />

  <style>
    body { font-family: 'Assistant', sans-serif; }
    .option-button.correct { background-color: #10b981; color: #fff; border-color: #059669; }
    .option-button.incorrect { background-color: #ef4444; color: #fff; border-color: #dc2626; }
    .option-button:disabled { opacity: 0.8; cursor: not-allowed; }
  </style>
</head>

<body class="bg-slate-50 flex items-center justify-center min-h-screen p-2 sm:p-4">

<div id="quiz-container" class="bg-white p-6 sm:p-8 rounded-2xl shadow-xl w-full max-w-2xl border-t-8 border-slate-800">

  <div class="mb-8 text-center">
    <h1 class="text-2xl font-bold text-slate-800">××‘×—×Ÿ ××‘×˜×—×ª ××•×¦×¨×™×</h1>
    <p class="text-slate-500 text-sm mt-1">×ª×¨×’×•×œ ×©××œ×•×ª ×××¨×™×§××™×•×ª ×œ×¤×™ × ×•×©××™ ×”×§×•×¨×¡</p>
  </div>

  <!-- ×‘×—×™×¨×ª × ×•×©××™× -->
  <div id="lecture-select-area">
    <div class="mb-6 p-4 bg-slate-100 rounded-xl">
      <p class="font-bold text-slate-700 mb-4">×‘×—×¨×• × ×•×©××™× ×œ×ª×¨×’×•×œ:</p>
      <div id="lecture-checkboxes" class="flex flex-col gap-3 text-slate-700">
        <label class="flex items-center gap-3 bg-white p-3 rounded-lg shadow-sm">
          <input type="checkbox" value="1" class="lecture-checkbox w-5 h-5" />
          <span>× ×•×©× 1 - Security properties and mechanisms</span>
        </label>
        <label class="flex items-center gap-3 bg-white p-3 rounded-lg shadow-sm">
          <input type="checkbox" value="2" class="lecture-checkbox w-5 h-5" />
          <span>× ×•×©× 2 - Vulnerabilities and Attacks</span>
        </label>
        <label class="flex items-center gap-3 bg-white p-3 rounded-lg shadow-sm">
          <input type="checkbox" value="3" class="lecture-checkbox w-5 h-5" />
          <span>× ×•×©× 3 - Authentication and Session Management</span>
        </label>
        <label class="flex items-center gap-3 bg-white p-3 rounded-lg shadow-sm">
          <input type="checkbox" value="4" class="lecture-checkbox w-5 h-5" />
          <span>× ×•×©× 4 - Access Control and Secure Design</span>
        </label>
        <label class="flex items-center gap-3 bg-white p-3 rounded-lg shadow-sm">
          <input type="checkbox" value="5" class="lecture-checkbox w-5 h-5" />
          <span>× ×•×©× 5 - Injection Attacks and XSS</span>
        </label>
        <label class="flex items-center gap-3 bg-white p-3 rounded-lg shadow-sm">
          <input type="checkbox" value="6" class="lecture-checkbox w-5 h-5" />
          <span>× ×•×©× 6 - Input Validation and Error Handling</span>
        </label>
      </div>
    </div>

    <label class="flex items-center gap-2 mb-6">
      <input id="show-all-checkbox" type="checkbox" class="w-4 h-4" />
      <span>×”×¦×’ ××ª ×›×œ ×”×©××œ×•×ª (×œ×œ× ×”×’×‘×œ×” ×©×œ 40)</span>
    </label>

    <button id="start-quiz-button"
      class="w-full bg-slate-800 hover:bg-slate-900 text-white font-bold py-4 rounded-xl">
      ×”×ª×—×œ ×ª×¨×’×•×œ
    </button>
  </div>

  <!-- ×”×ª×§×“××•×ª -->
  <div id="progress-container" class="hidden mb-6 flex justify-between border-b pb-4">
    <span id="progress-text" class="font-bold text-slate-600"></span>
    <span id="score-text" class="font-bold text-emerald-600"></span>
  </div>

  <!-- ×©××œ×” -->
  <div id="question-area" class="hidden">
    <h2 id="question-text" class="text-xl font-bold mb-6"></h2>
    <div id="options-container" class="flex flex-col gap-3"></div>
  </div>

  <!-- ×¤×™×“×‘×§ -->
  <div id="feedback-area" class="hidden mt-6 p-5 rounded-xl border-r-8 bg-slate-50">
    <p id="feedback-message" class="text-lg font-bold mb-1"></p>
    <p id="explanation-text" class="text-slate-600 text-sm italic"></p>
  </div>

  <!-- ×©×œ×™×˜×” -->
  <div id="controls-area" class="hidden mt-6">
    <button id="next-question-button"
      class="w-full bg-slate-800 text-white font-bold py-4 rounded-xl">
      ×”×©××œ×” ×”×‘××” â†
    </button>
  </div>

  <!-- ×¡×™×•× -->
  <div id="results-area" class="hidden text-center py-10">
    <div class="text-6xl mb-4">ğŸ›¡ï¸</div>
    <h2 class="text-3xl font-bold mb-2">×¡×™×™××ª ××ª ×”×ª×¨×’×•×œ!</h2>
    <p id="final-score-text" class="text-xl mb-6"></p>

    <button id="download-summary-button"
      class="bg-emerald-600 hover:bg-emerald-700 text-white font-bold py-3 px-8 rounded-xl mb-4">
      ×”×•×¨×“×ª ×¡×™×›×•× ×”××‘×—×Ÿ (JSON)
    </button>

    <br/>

    <button id="restart-quiz-button"
      class="bg-slate-800 hover:bg-slate-900 text-white font-bold py-3 px-8 rounded-xl">
      ×—×–×¨×” ×œ×‘×—×™×¨×ª × ×•×©××™×
    </button>
  </div>

</div>

<script>
const MAX_QUESTIONS = 40;
let ALL_QUESTIONS = [];
let shuffledQuestions = [];
let quizResults = [];
let currentIndex = 0;
let score = 0;

function shuffle(arr) {
  for (let i = arr.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [arr[i], arr[j]] = [arr[j], arr[i]];
  }
}

async function loadQuestions() {
  const selected = [...document.querySelectorAll('.lecture-checkbox:checked')].map(cb => cb.value);
  if (selected.length === 0) return alert('× × ×œ×‘×—×•×¨ ×œ×¤×—×•×ª × ×•×©× ××—×“');

  const arrays = [];
  for (const num of selected) {
    const res = await fetch(`questions${num}.json`);
    if (res.ok) arrays.push(await res.json());
  }

  ALL_QUESTIONS = arrays.flat().filter(q => q.type === 'mc');
  startQuiz();
}

function startQuiz() {
  shuffledQuestions = [...ALL_QUESTIONS];
  shuffle(shuffledQuestions);

  if (!document.getElementById('show-all-checkbox').checked && shuffledQuestions.length > MAX_QUESTIONS) {
    shuffledQuestions = shuffledQuestions.slice(0, MAX_QUESTIONS);
  }

  quizResults = [];
  currentIndex = 0;
  score = 0;

  document.getElementById('lecture-select-area').classList.add('hidden');
  document.getElementById('progress-container').classList.remove('hidden');
  document.getElementById('question-area').classList.remove('hidden');
  document.getElementById('controls-area').classList.remove('hidden');

  displayQuestion();
}

function displayQuestion() {
  const q = shuffledQuestions[currentIndex];
  document.getElementById('feedback-area').classList.add('hidden');
  document.getElementById('next-question-button').classList.add('hidden');

  document.getElementById('question-text').textContent = q.question;
  document.getElementById('progress-text').textContent = `×©××œ×” ${currentIndex + 1} ××ª×•×š ${shuffledQuestions.length}`;
  document.getElementById('score-text').textContent = `× ×™×§×•×“: ${score}`;

  const container = document.getElementById('options-container');
  container.innerHTML = '';

  q.options.forEach((opt, idx) => {
    const btn = document.createElement('button');
    btn.className = "option-button p-4 border-2 rounded-xl";
    btn.textContent = opt;
    btn.onclick = () => handleAnswer(idx, btn);
    container.appendChild(btn);
  });
}

function handleAnswer(idx, clickedBtn) {
  const q = shuffledQuestions[currentIndex];
  const isCorrect = idx === q.correctAnswerIndex;

  quizResults.push({
    question: q.question,
    options: q.options,
    correctAnswerIndex: q.correctAnswerIndex,
    userAnswerIndex: idx,
    isCorrect: isCorrect,
    explanation: q.explanation
  });

  document.querySelectorAll('.option-button').forEach(b => b.disabled = true);

  if (isCorrect) {
    score++;
    clickedBtn.classList.add('correct');
  } else {
    clickedBtn.classList.add('incorrect');
    document.querySelectorAll('.option-button')[q.correctAnswerIndex].classList.add('correct');
  }

  document.getElementById('feedback-message').textContent = isCorrect ? "âœ“ × ×›×•×Ÿ" : "âœ— ×œ× × ×›×•×Ÿ";
  document.getElementById('explanation-text').textContent = q.explanation;
  document.getElementById('feedback-area').classList.remove('hidden');
  document.getElementById('next-question-button').classList.remove('hidden');
}

function downloadQuizSummary() {
  const summary = {
    totalQuestions: shuffledQuestions.length,
    score: score,
    questions: quizResults
  };

  const blob = new Blob([JSON.stringify(summary, null, 2)], { type: "application/json" });
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "quiz-summary.json";
  a.click();
}

document.getElementById('start-quiz-button').onclick = loadQuestions;
document.getElementById('next-question-button').onclick = () => {
  currentIndex++;
  currentIndex < shuffledQuestions.length ? displayQuestion() : showResults();
};

function showResults() {
  document.getElementById('question-area').classList.add('hidden');
  document.getElementById('controls-area').classList.add('hidden');
  document.getElementById('feedback-area').classList.add('hidden');
  document.getElementById('progress-container').classList.add('hidden');
  document.getElementById('results-area').classList.remove('hidden');

  document.getElementById('final-score-text').textContent =
    `×¦×‘×¨×ª ${score} × ×§×•×“×•×ª ××ª×•×š ${shuffledQuestions.length}`;
}

document.getElementById('restart-quiz-button').onclick = () => location.reload();
document.getElementById('download-summary-button').onclick = downloadQuizSummary;
</script>

</body>
</html>
